From c9a9472927a274ab945535130a52f55fd8781388 Mon Sep 17 00:00:00 2001
From: Philip Withnall <philip.withnall@collabora.co.uk>
Date: Wed, 29 Jan 2014 11:12:31 +0000
Subject: [PATCH] backends: Fix calls to ImDetails.normalise_im_address()
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Newer versions of the Vala compiler have got stricter about unnecessary
(owned) transfer annotations. Folks had some unnecessary ones, which
have now been removed. This shouldnâ€™t affect compilation with older
versions of Vala, though this is untested.

https://bugzilla.gnome.org/show_bug.cgi?id=723054
---
 NEWS                                       | 2 ++
 backends/eds/lib/edsf-persona.vala         | 4 ++--
 backends/libsocialweb/lib/swf-persona.vala | 5 ++---
 backends/tracker/lib/trf-persona.vala      | 5 ++---
 4 files changed, 8 insertions(+), 8 deletions(-)

diff --git a/backends/eds/lib/edsf-persona.vala b/backends/eds/lib/edsf-persona.vala
index 58f6c6c..26cd2e0 100644
--- a/backends/eds/lib/edsf-persona.vala
+++ b/backends/eds/lib/edsf-persona.vala
@@ -1663,7 +1663,7 @@ public class Edsf.Persona : Folks.Persona,
                     }
 
                   string normalised_addr =
-                    (owned) ImDetails.normalise_im_address ((!) addr, im_proto);
+                    ImDetails.normalise_im_address ((!) addr, im_proto);
 
                   if (normalised_addr == "")
                     {
@@ -1720,7 +1720,7 @@ public class Edsf.Persona : Folks.Persona,
               try
                 {
                   string normalised_addr =
-                    (owned) ImDetails.normalise_im_address (email.value, proto);
+                    ImDetails.normalise_im_address (email.value, proto);
                   var im_fd = new ImFieldDetails (normalised_addr);
                   new_im_addresses.set (proto, im_fd);
                 }
diff --git a/backends/libsocialweb/lib/swf-persona.vala b/backends/libsocialweb/lib/swf-persona.vala
index aceff83..7883374 100644
--- a/backends/libsocialweb/lib/swf-persona.vala
+++ b/backends/libsocialweb/lib/swf-persona.vala
@@ -279,9 +279,8 @@ public class Swf.Persona : Folks.Persona,
         {
           try
             {
-              var facebook_jid_copy = facebook_jid.dup();
-              var normalised_addr = (owned) normalise_im_address
-                  ((owned) facebook_jid_copy, "jabber");
+              var normalised_addr = ImDetails.normalise_im_address
+                  (facebook_jid, "jabber");
               string im_proto = "jabber";
               var im_fd = new ImFieldDetails (normalised_addr);
 
diff --git a/backends/tracker/lib/trf-persona.vala b/backends/tracker/lib/trf-persona.vala
index e54dfdd..71b4a24 100644
--- a/backends/tracker/lib/trf-persona.vala
+++ b/backends/tracker/lib/trf-persona.vala
@@ -1153,9 +1153,8 @@ public class Trf.Persona : Folks.Persona,
     {
       try
         {
-          var account_id_copy = account_id.dup ();
-          var normalised_addr = (owned) normalise_im_address
-              ((owned) account_id_copy, im_proto);
+          var normalised_addr = ImDetails.normalise_im_address
+              (account_id, im_proto);
           var im_fd = new ImFieldDetails (normalised_addr);
 
           this._im_addresses.set (im_proto, im_fd);
-- 
1.9.0

